<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campanhas - Causa Digital</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💙</text></svg>">
  <script src="auth-helper.js" defer></script>
</head>
<body>
  <nav>
    <div class="container nav-container">
      <a href="index.html" class="logo">Causa Digital</a>
      <div class="nav-links">
        <a href="campanhas.html">Campanhas</a>
        <a href="ongs.html">ONGs</a>
        <button id="modoBtn" class="btn-toggle">🌙</button>
      </div>
    </div>
  </nav>
  <section class="section">
    <div class="container">
      <span class="badge badge-primary">🎯 Campanhas</span>
      <h1 style="margin-top: 1rem;">Encontre uma causa para apoiar</h1>
      <p class="subtitle">Explore campanhas verificadas e faca a diferenca hoje.</p>
      <div class="filter-bar">
        <input type="text" id="busca" placeholder="🔍 Buscar campanhas..." style="flex: 1; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-primary); color: var(--text-primary);">
        <select id="categoria" style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-primary); color: var(--text-primary);">
          <option value="">Todas categorias</option>
          <option value="alimentacao">🍲 Alimentacao</option>
          <option value="educacao">📚 Educacao</option>
          <option value="saude">🏥 Saude</option>
          <option value="outros">🎮 Outros</option>
        </select>
      </div>
      <div id="listaCampanhas" class="grid" style="margin-top: 2rem;">
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
      </div>
    </div>
  </section>
  <script>
    const body = document.body;
    const modoBtn = document.getElementById("modoBtn");
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      modoBtn.textContent = "☀️";
    }
    modoBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const dark = body.classList.contains("dark");
      localStorage.setItem("theme", dark ? "dark" : "light");
      modoBtn.textContent = dark ? "☀️" : "🌙";
    });

    const mockCampanhas = [
      { _id: "1", titulo: "Cesta Basica para 100 Familias", descricao: "Ajude familias em vulnerabilidade alimentar.", meta: 5000, arrecadado: 4500, categoria: "alimentacao" },
      { _id: "2", titulo: "Material Escolar Completo", descricao: "Kits escolares para criancas carentes.", meta: 10000, arrecadado: 8200, categoria: "educacao" },
      { _id: "3", titulo: "Medicamentos Essenciais", descricao: "Compra de medicamentos para idosos.", meta: 8000, arrecadado: 6100, categoria: "saude" },
      { _id: "4", titulo: "Computadores para Escola", descricao: "Laboratorio de informatica para escola publica.", meta: 15000, arrecadado: 3500, categoria: "educacao" },
      { _id: "5", titulo: "Reforma do Abrigo", descricao: "Melhorias no abrigo de animais abandonados.", meta: 12000, arrecadado: 9800, categoria: "outros" },
      { _id: "6", titulo: "Almoco Solidario", descricao: "Refeicoes diarias para moradores de rua.", meta: 6000, arrecadado: 4200, categoria: "alimentacao" }
    ];

    let campanhas = [];
    const container = document.getElementById("listaCampanhas");
    const inputBusca = document.getElementById("busca");
    const selectCategoria = document.getElementById("categoria");

    function getCategoriaEmoji(cat) {
      const emojis = { alimentacao: "🍲", educacao: "📚", saude: "🏥", outros: "🎮" };
      return emojis[cat] || "💙";
    }

    function renderCampanhas(lista) {
      if (!lista.length) {
        container.innerHTML = `<div class="card" style="grid-column: 1/-1; text-align: center; padding: 3rem;"><p>Nenhuma campanha encontrada.</p></div>`;
        return;
      }
      container.innerHTML = lista.map(c => {
        const percentual = Math.round((c.arrecadado / c.meta) * 100);
        return `
          <div class="card">
            <div style="font-size: 3rem; margin-bottom: 1rem;">${getCategoriaEmoji(c.categoria)}</div>
            <span class="badge">${c.categoria}</span>
            <h3 style="margin: 0.5rem 0;">${c.titulo}</h3>
            <p style="font-size: 0.9rem; margin-bottom: 1rem; flex-grow: 1;">${c.descricao}</p>
            <div class="progress"><div style="width: ${percentual}%;"></div></div>
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 0.5rem;">
              <strong>R$ ${c.arrecadado.toLocaleString()}</strong>
              <span>de R$ ${c.meta.toLocaleString()}</span>
            </div>
            <a href="doacao.html?id=${c._id}" class="btn-primary" style="width: 100%; margin-top: 1rem; text-align: center; text-decoration: none; display: block;">Doar Agora</a>
          </div>
        `;
      }).join("");
    }

    function filtrar() {
      const busca = inputBusca.value.toLowerCase();
      const categoria = selectCategoria.value;
      const filtradas = campanhas.filter(c => {
        const matchBusca = c.titulo.toLowerCase().includes(busca) || c.descricao.toLowerCase().includes(busca);
        const matchCategoria = !categoria || c.categoria === categoria;
        return matchBusca && matchCategoria;
      });
      renderCampanhas(filtradas);
    }

    inputBusca.addEventListener("input", filtrar);
    selectCategoria.addEventListener("change", filtrar);

    async function carregarCampanhas() {
      try {
        const res = await fetch("/api/campanhas");
        if (res.ok) {
          campanhas = await res.json();
        }
        if (!campanhas.length) campanhas = mockCampanhas;
      } catch (error) {
        campanhas = mockCampanhas;
      }
      renderCampanhas(campanhas);
    }

    carregarCampanhas();
  </script>
</body>
</html>
