<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONGs - Causa Digital</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💚</text></svg>">
  <script src="auth-helper.js" defer></script>
</head>
<body>
  <nav>
    <div class="container nav-container">
      <a href="index.html" class="logo">Causa Digital</a>
      <div class="nav-links">
        <a href="campanhas.html">Campanhas</a>
        <a href="ongs.html">ONGs</a>
        <button id="modoBtn" class="btn-toggle">🌙</button>
      </div>
    </div>
  </nav>
  <section class="section">
    <div class="container">
      <span class="badge badge-primary">🏢 ONGs Parceiras</span>
      <h1 style="margin-top: 1rem;">Conheca nossas organizacoes</h1>
      <p class="subtitle">Todas as ONGs sao verificadas e comprometidas com transparencia total.</p>
      <div id="listaOngs" class="grid" style="margin-top: 2rem;">
        <div class="card skeleton">
          <div style="height: 80px; width: 80px; border-radius: 50%; background: var(--bg-secondary); margin: 0 auto 1rem;"></div>
          <div style="height: 20px; width: 60%; background: var(--bg-secondary); margin: 0 auto 0.5rem;"></div>
          <div style="height: 16px; width: 80%; background: var(--bg-secondary); margin: 0 auto;"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 80px; width: 80px; border-radius: 50%; background: var(--bg-secondary); margin: 0 auto 1rem;"></div>
          <div style="height: 20px; width: 60%; background: var(--bg-secondary); margin: 0 auto 0.5rem;"></div>
          <div style="height: 16px; width: 80%; background: var(--bg-secondary); margin: 0 auto;"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 80px; width: 80px; border-radius: 50%; background: var(--bg-secondary); margin: 0 auto 1rem;"></div>
          <div style="height: 20px; width: 60%; background: var(--bg-secondary); margin: 0 auto 0.5rem;"></div>
          <div style="height: 16px; width: 80%; background: var(--bg-secondary); margin: 0 auto;"></div>
        </div>
      </div>
    </div>
  </section>
  <script>
    const body = document.body;
    const modoBtn = document.getElementById("modoBtn");
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      modoBtn.textContent = "☀️";
    }
    modoBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const dark = body.classList.contains("dark");
      localStorage.setItem("theme", dark ? "dark" : "light");
      modoBtn.textContent = dark ? "☀️" : "🌙";
    });

    const mockOngs = [
      { _id: "1", nome: "Alimentacao Solidaria", descricao: "Combatendo a fome em comunidades vulneraveis.", website: "https://alimentacao.org", campanhasAtivas: 3 },
      { _id: "2", nome: "Educacao para Todos", descricao: "Democratizando o acesso a educacao de qualidade.", website: "https://educacao.org", campanhasAtivas: 2 },
      { _id: "3", nome: "Saude na Comunidade", descricao: "Levando saude basica a quem mais precisa.", website: "https://saude.org", campanhasAtivas: 4 }
    ];

    async function carregarOngs() {
      const container = document.getElementById("listaOngs");
      try {
        const res = await fetch("/api/ongs");
        let ongs = [];
        if (res.ok) {
          ongs = await res.json();
        }
        if (!ongs.length) ongs = mockOngs;
        renderOngs(ongs, container);
      } catch (error) {
        renderOngs(mockOngs, container);
      }
    }

    function renderOngs(lista, container) {
      container.innerHTML = lista.map(ong => `
        <div class="card" style="text-align: center;">
          <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 1rem;">
            ${ong.nome.charAt(0)}
          </div>
          <h3 style="margin-bottom: 0.5rem;">${ong.nome}</h3>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">${ong.descricao}</p>
          <div style="display: flex; justify-content: center; gap: 1rem; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
            <span>📋 ${ong.campanhasAtivas || 0} campanhas</span>
          </div>
          <a href="${ong.website}" target="_blank" class="btn-secondary" style="text-decoration: none; display: inline-block;">Visitar site</a>
        </div>
      `).join("");
    }

    carregarOngs();
  </script>
</body>
</html>
