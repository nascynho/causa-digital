<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Causa Digital â€” Transforme Vidas com TransparÃªncia</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’™</text></svg>">
</head>
<body>

  <!-- NAV -->
  <nav>
    <div class="container nav-container">
      <a href="index.html" class="logo">Causa Digital</a>
      <div class="nav-links">
        <a href="campanhas.html">Campanhas</a>
        <a href="ongs.html">ONGs</a>
        <a href="auth.html" class="btn-secondary outline">Entrar</a>
        <a href="cadastro.html" class="btn-primary">Criar conta</a>
        <button id="modoBtn" class="btn-toggle">ğŸŒ™</button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <h1>Transforme vidas com<br>transparÃªncia total</h1>
      <p>A plataforma de doaÃ§Ãµes gamificada onde vocÃª acompanha cada centavo do seu apoio. Doe, acumule pontos, desbloqueie conquistas e veja o impacto real da sua generosidade.</p>
      <div class="hero-buttons">
        <a href="campanhas.html" class="btn-primary">ğŸ¯ Ver Campanhas</a>
        <a href="cadastro.html" class="btn-secondary">ğŸ¢ Cadastrar ONG</a>
      </div>
    </div>
  </header>

  <!-- DESTAQUES -->
  <section class="section">
    <div class="container">
      <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 2rem;">
        <div>
          <h2>ğŸ”¥ Campanhas em Destaque</h2>
          <p class="subtitle">Causas urgentes que precisam do seu apoio agora</p>
        </div>
        <a href="campanhas.html" style="color: var(--primary); font-weight: 600; text-decoration: none;">Ver todas &rarr;</a>
      </div>
      
      <div id="destaques" class="grid">
        <!-- Cards serï¿½o inseridos aqui via JS -->
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- RANKING -->
  <section class="section" style="background: var(--bg-secondary);">
    <div class="container">
      <div style="text-align: center; margin-bottom: 3rem;">
        <h2>ğŸ† Top Doadores da Semana</h2>
        <p class="subtitle" style="margin: 0 auto;">Reconhecimento para quem faz a diferenÃ§a</p>
      </div>
      
      <div id="ranking" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
        <!-- Ranking via JS -->
      </div>
    </div>
  </section>

  <!-- COMO FUNCIONA -->
  <section class="section">
    <div class="container">
      <div style="text-align: center; margin-bottom: 3rem;">
        <h2>âš¡ Como Funciona</h2>
        <p class="subtitle" style="margin: 0 auto;">TransparÃªncia total, do primeiro clique ao impacto final</p>
      </div>

      <div class="grid">
        <div class="card">
          <span class="badge badge-primary">Passo 1</span>
          <h3>Cadastre sua ONG</h3>
          <p>Crie campanhas com metas claras, imagens e mÃ©tricas de impacto para inspirar confianÃ§a.</p>
        </div>
        <div class="card">
          <span class="badge badge-primary">Passo 2</span>
          <h3>Engaje doadores</h3>
          <p>Os doadores acompanham progresso em tempo real, acumulam pontos e desbloqueiam conquistas.</p>
        </div>
        <div class="card">
          <span class="badge badge-primary">Passo 3</span>
          <h3>Mostre resultados</h3>
          <p>Use o painel para atualizar indicadores, gerar relatÃ³rios e compartilhar o impacto alcanÃ§ado.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer style="padding: 4rem 0; border-top: 1px solid var(--border-color);">
    <div class="container" style="text-align: center;">
      <h3 class="logo" style="margin-bottom: 1rem;">ğŸ’™ Causa Digital</h3>
      <p style="color: var(--text-secondary);">Â© 2025 Causa Digital. Feito com amor para transformar vidas.</p>
      <div style="margin-top: 1rem; display: flex; justify-content: center; gap: 1.5rem;">
        <a href="campanhas.html" style="color: var(--text-secondary); text-decoration: none;">Campanhas</a>
        <a href="ongs.html" style="color: var(--text-secondary); text-decoration: none;">ONGs</a>
        <a href="cadastro.html" style="color: var(--text-secondary); text-decoration: none;">Cadastro</a>
      </div>
    </div>
  </footer>

  <script>
    // Dark Mode
    const body = document.body;
    const btn = document.getElementById("modoBtn");
    
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      btn.textContent = "â˜€ï¸";
    }

    btn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const isDark = body.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      btn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
    });

    // Dados Mockados (Fallback)
    const mockCampanhas = [
      {
        titulo: "AlimentaÃ§Ã£o Escolar",
        descricao: "Ajude a fornecer merenda nutritiva para 200 crianÃ§as em situaÃ§Ã£o de vulnerabilidade.",
        meta: 5000,
        arrecadado: 3250,
        imagem: "https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?w=400&h=250&fit=crop"
      },
      {
        titulo: "Reforma do Abrigo",
        descricao: "Precisamos reformar o telhado do abrigo de animais antes das chuvas de verÃ£o.",
        meta: 12000,
        arrecadado: 8900,
        imagem: "https://images.unsplash.com/photo-1570051008600-b34baa49e751?w=400&h=250&fit=crop"
      },
      {
        titulo: "Kits de Higiene",
        descricao: "DistribuiÃ§Ã£o de kits de higiene pessoal para moradores em situaÃ§Ã£o de rua.",
        meta: 2000,
        arrecadado: 450,
        imagem: "https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?w=400&h=250&fit=crop"
      }
    ];

    const mockRanking = [
      { nome: "Ana Silva", pontos: 1250, nivel: 5 },
      { nome: "Carlos Oliveira", pontos: 980, nivel: 4 },
      { nome: "Mariana Santos", pontos: 850, nivel: 3 },
      { nome: "JoÃ£o Pedro", pontos: 720, nivel: 3 }
    ];

    async function carregarDestaques() {
      const container = document.getElementById("destaques");
      try {
        const res = await fetch("/api/campanhas/destaques");
        let dados = [];
        if (res.ok) {
          dados = await res.json();
        } else {
          throw new Error("API falhou");
        }
        
        if (dados.length === 0) dados = mockCampanhas;
        renderizarCampanhas(dados, container);
      } catch (error) {
        console.log("Usando dados mockados para destaques");
        renderizarCampanhas(mockCampanhas, container);
      }
    }

    function renderizarCampanhas(lista, container) {
      container.innerHTML = lista.map(c => {
        const percentual = Math.min((c.arrecadado / c.meta) * 100, 100);
        return `
          <div class="card">
            <img src="${c.imagem}" alt="${c.titulo}" style="height: 200px; object-fit: cover; border-radius: var(--radius); margin-bottom: 1rem;">
            <h4>${c.titulo}</h4>
            <p style="font-size: 0.9rem; margin-bottom: 1rem; flex-grow: 1;">${c.descricao}</p>
            
            <div class="progress"><div style="width: ${percentual}%;"></div></div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; margin-top: 0.5rem;">
              <strong>R$ ${c.arrecadado.toLocaleString()}</strong>
              <span style="color: var(--text-secondary);">de R$ ${c.meta.toLocaleString()}</span>
            </div>
            
            <a href="doacao.html?id=${c._id}" class="btn-primary" style="width: 100%; margin-top: 1.5rem; text-align: center; text-decoration: none; display: block;">Doar Agora</a>
          </div>
        `;
      }).join("");
    }

    async function carregarRanking() {
      const container = document.getElementById("ranking");
      try {
        const res = await fetch("/api/ranking");
        let dados = [];
        if (res.ok) {
          dados = await res.json();
        } else {
          throw new Error("API falhou");
        }
        
        if (dados.length === 0) dados = mockRanking;
        renderizarRanking(dados, container);
      } catch (error) {
        console.log("Usando dados mockados para ranking");
        renderizarRanking(mockRanking, container);
      }
    }

    function rankingMedal(index) {
      const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
      return medals[index] || `#${index + 1}`;
    }

    function renderizarRanking(lista, container) {
      container.innerHTML = lista.map((u, index) => `
        <div class="card" style="text-align: center; padding: 1.5rem;">
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">${rankingMedal(index)}</div>
          <h4 style="margin-bottom: 0.25rem;">${u.nome}</h4>
          <p style="color: var(--primary); font-weight: 600; margin-bottom: 0;">${u.pontos.toLocaleString()} pts</p>
          <p style="font-size: 0.8rem; color: var(--text-secondary);">NÃ­vel ${u.nivel}</p>
        </div>
      `).join("");
    }

    carregarDestaques();
    carregarRanking();
  </script>

</body>
</html>
