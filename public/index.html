<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Causa Digital - Transforme Vidas com Transparencia</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’™</text></svg>">
  <script src="auth-helper.js" defer></script>
</head>
<body>
  <nav>
    <div class="container nav-container">
      <a href="index.html" class="logo">Causa Digital</a>
      <div class="nav-links">
        <a href="campanhas.html">Campanhas</a>
        <a href="ongs.html">ONGs</a>
        <button id="modoBtn" class="btn-toggle">ğŸŒ™</button>
      </div>
    </div>
  </nav>
  <header class="hero">
    <div class="container">
      <h1>Transforme vidas com<br>transparencia total</h1>
      <p>A plataforma de doacoes gamificada onde voce acompanha cada centavo do seu apoio. Doe, acumule pontos, desbloqueie conquistas e veja o impacto real da sua generosidade.</p>
      <div class="hero-buttons">
        <a href="campanhas.html" class="btn-primary">ğŸ¯ Ver Campanhas</a>
        <a href="cadastro.html" class="btn-secondary">ğŸ¢ Cadastrar ONG</a>
      </div>
    </div>
  </header>
  <section class="section">
    <div class="container">
      <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 2rem;">
        <div>
          <h2>ğŸ”¥ Campanhas em Destaque</h2>
          <p class="subtitle">Causas urgentes que precisam do seu apoio agora</p>
        </div>
        <a href="campanhas.html" style="color: var(--primary); font-weight: 600; text-decoration: none;">Ver todas &rarr;</a>
      </div>
      <div id="destaques" class="grid">
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
        <div class="card skeleton">
          <div style="height: 200px; background: var(--bg-secondary); border-radius: var(--radius); margin-bottom: 1rem;"></div>
          <div style="height: 20px; width: 70%; background: var(--bg-secondary); margin-bottom: 0.5rem;"></div>
          <div style="height: 16px; width: 40%; background: var(--bg-secondary);"></div>
        </div>
      </div>
    </div>
  </section>
  <section class="section" style="background: var(--bg-secondary);">
    <div class="container">
      <div style="text-align: center; margin-bottom: 3rem;">
        <h2>ğŸ† Top Doadores da Semana</h2>
        <p class="subtitle" style="margin: 0 auto;">Reconhecimento para quem faz a diferenca</p>
      </div>
      <div id="ranking" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
      </div>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <div style="text-align: center; margin-bottom: 3rem;">
        <h2>âš¡ Como Funciona</h2>
        <p class="subtitle" style="margin: 0 auto;">Transparencia total, do primeiro clique ao impacto final</p>
      </div>
      <div class="grid">
        <div class="card">
          <span class="badge badge-primary">Passo 1</span>
          <h3>Cadastre sua ONG</h3>
          <p>Crie campanhas com metas claras, imagens e metricas de impacto para inspirar confianca.</p>
        </div>
        <div class="card">
          <span class="badge badge-primary">Passo 2</span>
          <h3>Engaje doadores</h3>
          <p>Doadores ganham pontos, sobem de nivel e desbloqueiam badges conforme contribuem.</p>
        </div>
        <div class="card">
          <span class="badge badge-primary">Passo 3</span>
          <h3>Acompanhe o impacto</h3>
          <p>Veja em tempo real como sua doacao esta transformando vidas com total transparencia.</p>
        </div>
      </div>
    </div>
  </section>
  <footer style="padding: 3rem 0; border-top: 1px solid var(--border-color);">
    <div class="container" style="text-align: center;">
      <p style="color: var(--text-secondary);">ğŸ’™ 2025 Causa Digital - Transformando vidas com transparencia</p>
    </div>
  </footer>
  <script>
    const body = document.body;
    const btn = document.getElementById("modoBtn");
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      btn.textContent = "â˜€ï¸";
    }
    btn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const dark = body.classList.contains("dark");
      localStorage.setItem("theme", dark ? "dark" : "light");
      btn.textContent = dark ? "â˜€ï¸" : "ğŸŒ™";
    });

    const mockDestaques = [
      { _id: "1", titulo: "Cesta Basica para 100 Familias", descricao: "Ajude familias em vulnerabilidade.", meta: 5000, arrecadado: 4500, percentualConcluido: 90 },
      { _id: "2", titulo: "Material Escolar Completo", descricao: "Kits escolares para criancas.", meta: 10000, arrecadado: 8200, percentualConcluido: 82 },
      { _id: "3", titulo: "Medicamentos Essenciais", descricao: "Compra de medicamentos.", meta: 8000, arrecadado: 6100, percentualConcluido: 76 }
    ];

    const mockRanking = [
      { nome: "Joao Santos", pontos: 1200, nivel: 3 },
      { nome: "Maria Silva", pontos: 850, nivel: 2 },
      { nome: "Ana Costa", pontos: 300, nivel: 1 }
    ];

    async function carregarDestaques() {
      const container = document.getElementById("destaques");
      try {
        const res = await fetch("/api/campanhas/destaques?limit=3");
        let dados = [];
        if (res.ok) {
          dados = await res.json();
        }
        if (!dados.length) dados = mockDestaques;
        renderizarDestaques(dados, container);
      } catch (error) {
        renderizarDestaques(mockDestaques, container);
      }
    }

    function renderizarDestaques(lista, container) {
      container.innerHTML = lista.map(c => {
        const percentual = c.percentualConcluido || Math.round((c.arrecadado / c.meta) * 100);
        return `
          <div class="card">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’™</div>
            <h3 style="margin-bottom: 0.5rem;">${c.titulo}</h3>
            <p style="font-size: 0.9rem; margin-bottom: 1rem; flex-grow: 1;">${c.descricao}</p>
            <div class="progress"><div style="width: ${percentual}%;"></div></div>
            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; margin-top: 0.5rem;">
              <strong>R$ ${c.arrecadado.toLocaleString()}</strong>
              <span style="color: var(--text-secondary);">de R$ ${c.meta.toLocaleString()}</span>
            </div>
            <a href="doacao.html?id=${c._id}" class="btn-primary" style="width: 100%; margin-top: 1.5rem; text-align: center; text-decoration: none; display: block;">Doar Agora</a>
          </div>
        `;
      }).join("");
    }

    async function carregarRanking() {
      const container = document.getElementById("ranking");
      try {
        const res = await fetch("/api/ranking");
        let dados = [];
        if (res.ok) {
          dados = await res.json();
        }
        if (!dados.length) dados = mockRanking;
        renderizarRanking(dados, container);
      } catch (error) {
        renderizarRanking(mockRanking, container);
      }
    }

    function rankingMedal(index) {
      const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
      return medals[index] || `#${index + 1}`;
    }

    function renderizarRanking(lista, container) {
      container.innerHTML = lista.map((u, index) => `
        <div class="card" style="text-align: center; padding: 1.5rem;">
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">${rankingMedal(index)}</div>
          <h4 style="margin-bottom: 0.25rem;">${u.nome}</h4>
          <p style="color: var(--primary); font-weight: 600; margin-bottom: 0;">${u.pontos.toLocaleString()} pts</p>
          <p style="font-size: 0.8rem; color: var(--text-secondary);">Nivel ${u.nivel}</p>
        </div>
      `).join("");
    }

    carregarDestaques();
    carregarRanking();
  </script>
</body>
</html>
