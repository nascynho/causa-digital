<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel da ONG ‚Äî Causa Digital</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíô</text></svg>">
</head>
<body>

  <!-- NAV -->
  <nav>
    <div class="container nav-container">
      <a href="index.html" class="logo">Causa Digital</a>
      <div class="nav-links">
        <a href="campanhas.html">Campanhas</a>
        <a href="ongs.html">ONGs</a>
        <a href="auth.html" class="btn-secondary outline">Trocar conta</a>
        <button id="modoBtn" class="btn-toggle">üåô</button>
      </div>
    </div>
  </nav>

  <section class="section">
    <div class="container">
      <h2>üè¢ Painel de Controle</h2>
      <p class="subtitle">Gerencie suas campanhas e acompanhe o impacto da sua ONG em tempo real</p>

      <div class="helper-banner">
        <div>
          <strong>Pr√≥ximo passo recomendado</strong>
          <p id="painelHint">Crie sua primeira campanha para liberar indicadores no relat√≥rio.</p>
        </div>
        <div style="margin-left: auto; display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <a href="#criar" class="btn-primary">Nova campanha</a>
          <a href="#campanhas" class="btn-secondary outline">Ver campanhas</a>
        </div>
      </div>

      <!-- STATS DA ONG -->
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 3rem;">
        <div class="stat-box">
          <h3 id="totalCampanhas">0</h3>
          <p>Campanhas Ativas</p>
        </div>
        <div class="stat-box">
          <h3 id="totalArrecadado">R$ 0</h3>
          <p>Total Arrecadado</p>
        </div>
        <div class="stat-box">
          <h3 id="metasAlcancadas">0</h3>
          <p>Metas Atingidas</p>
        </div>
        <div class="stat-box">
          <h3 id="seguidores">0</h3>
          <p>Apoiadores</p>
        </div>
      </div>

      <!-- TABS -->
      <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid var(--bg-secondary); flex-wrap: wrap;">
        <button class="tab-btn active" data-tab="criar" style="padding: 0.75rem 1.5rem; background: none; border: none; cursor: pointer; font-weight: 600; color: var(--accent); border-bottom: 3px solid var(--accent); font-size: 1rem;">‚ûï Nova Campanha</button>
        <button class="tab-btn" data-tab="campanhas" style="padding: 0.75rem 1.5rem; background: none; border: none; cursor: pointer; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; font-size: 1rem;">üìù Minhas Campanhas</button>
        <button class="tab-btn" data-tab="relatorios" style="padding: 0.75rem 1.5rem; background: none; border: none; cursor: pointer; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; font-size: 1rem;">üìä Relat√≥rios</button>
      </div>

      <!-- CRIAR CAMPANHA -->
      <div id="criar" class="tab-content" style="display: block;">
        <form id="formCampanha" class="form">
          <h3 style="margin-bottom: 1.5rem;">Cadastre uma Nova Campanha</h3>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
            <div class="form-group">
              <label>T√≠tulo da Campanha *</label>
              <input type="text" name="titulo" required placeholder="Ex: Alimenta√ß√£o para crian√ßas">
            </div>

            <div class="form-group">
              <label>Categoria *</label>
              <select name="categoria" required>
                <option value="">Selecione...</option>
                <option value="alimentacao">Alimenta√ß√£o</option>
                <option value="saude">Sa√∫de</option>
                <option value="educacao">Educa√ß√£o</option>
                <option value="abrigo">Abrigo</option>
                <option value="outro">Outra</option>
              </select>
            </div>

            <div class="form-group">
              <label>Meta em R$ *</label>
              <input type="number" name="meta" min="100" required placeholder="Ex: 5000">
            </div>
          </div>

          <div class="form-group">
            <label>Descri√ß√£o *</label>
            <textarea name="descricao" rows="4" required placeholder="Descreva detalhadamente a causa e por que precisa de ajuda..."></textarea>
          </div>

          <div class="form-group">
            <label>Descri√ß√£o do Impacto (Ex: Alimentar√° 50 crian√ßas)</label>
            <input type="text" name="impactoDescricao" placeholder="Qual ser√° o impacto concreto dessa arrecada√ß√£o?">
          </div>

          <div class="form-group">
            <label>Imagem (URL)</label>
            <input type="url" name="imagem" placeholder="https://exemplo.com/imagem.jpg">
          </div>

          <button type="submit" class="btn-primary" style="width: 100%;">Criar Campanha</button>
        </form>
      </div>

      <!-- MINHAS CAMPANHAS -->
      <div id="campanhas" class="tab-content" style="display: none;">
        <h3 style="margin-bottom: 1.5rem;">Suas Campanhas Ativas</h3>
        <div id="campanhasList" class="grid">
          <p class="loading-message" style="grid-column: 1 / -1;">Carregando campanhas...</p>
        </div>
      </div>

      <!-- RELAT√ìRIOS -->
      <div id="relatorios" class="tab-content" style="display: none;">
        <h3 style="margin-bottom: 1.5rem;">Relat√≥rio de Impacto</h3>
        <div id="relatoriosContainer" style="display: grid; gap: 2rem;">
          <div class="card">
            <h4>Distribui√ß√£o por Categoria</h4>
            <div id="categoriaChart" style="display: flex; gap: 0.5rem; height: 200px; align-items: flex-end; margin-top: 1rem;"></div>
          </div>
          <div class="card">
            <h4>Top 10 Doadores</h4>
            <div id="topDoadores"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer style="padding: 3rem 0; border-top: 1px solid var(--border-color); margin-top: 2rem;">
    <div class="container" style="text-align: center;">
      <p style="color: var(--text-secondary);">üíô ¬© 2025 Causa Digital ‚Äî Painel de Gest√£o de ONGs</p>
    </div>
  </footer>

  <!-- SCRIPT -->
  <script>
    const body = document.body;
    const btn = document.getElementById("modoBtn");
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark");
      btn.textContent = "‚òÄÔ∏è";
    }
    btn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const dark = body.classList.contains("dark");
      localStorage.setItem("theme", dark ? "dark" : "light");
      btn.textContent = dark ? "‚òÄÔ∏è" : "üåô";
    });

    // Simular ID da ONG
    const ongId = localStorage.getItem("ongId") || "ong123";

    const form = document.getElementById("formCampanha");
    const lista = document.getElementById("campanhasList");
    const painelHint = document.getElementById("painelHint");

    async function carregarCampanhas() {
      lista.innerHTML = '<p class="loading-message" style="grid-column: 1 / -1;">Carregando campanhas...</p>';
      try {
        const res = await fetch("/api/campanhas");
        const data = await res.json();
        
        let totalArrecadado = 0;
        let metasAlcancadas = 0;
        
        if (!data.length) {
          lista.innerHTML = '<p class="loading-message" style="grid-column: 1 / -1;">Nenhuma campanha cadastrada ainda.</p>';
        } else {
          lista.innerHTML = data.map(c => {
            const percentual = Math.min((c.arrecadado / c.meta) * 100, 100);
            if (percentual >= 100) metasAlcancadas++;
            totalArrecadado += c.arrecadado;

            return `
              <div class="card">
                <img src="${c.imagem || 'https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=400&h=250&fit=crop'}" alt="${c.titulo}" style="height: 200px; object-fit: cover; border-radius: var(--radius); margin-bottom: 1rem;">
                <h4>${c.titulo}</h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">${c.descricao}</p>
                <div class="progress"><div style="width:${percentual}%;"></div></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; font-size: 0.9rem;">
                  <strong>R$ ${c.arrecadado.toLocaleString()}</strong>
                  <span style="color: var(--text-secondary);">de R$ ${c.meta.toLocaleString()}</span>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                  <span style="flex-grow: 1; text-align: center; padding: 0.5rem; border-radius: 6px; background: var(--bg-secondary); font-size: 0.85rem; font-weight: 600;">${Math.round(percentual)}% conclu√≠do</span>
                  <button class="btn-secondary outline" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Editar</button>
                </div>
              </div>
            `;
          }).join("");
        }

        document.getElementById("totalCampanhas").textContent = data.length;
        document.getElementById("totalArrecadado").textContent = `R$ ${totalArrecadado.toLocaleString()}`;
        document.getElementById("metasAlcancadas").textContent = metasAlcancadas;
        painelHint.textContent = data.length ? "Mantenha suas campanhas atualizadas para refor√ßar a confian√ßa dos doadores." : "Cadastre sua primeira campanha para liberar m√©tricas de impacto.";
      } catch (error) {
        console.error("Erro ao carregar campanhas:", error);
        painelHint.textContent = "N√£o foi poss√≠vel carregar os dados agora. Tente novamente em instantes.";
        lista.innerHTML = '<p class="loading-message" style="grid-column: 1 / -1;">N√£o foi poss√≠vel carregar as campanhas.</p>';
      }
    }

    form.addEventListener("submit", async e => {
      e.preventDefault();
      const formData = new FormData(form);
      const obj = Object.fromEntries(formData.entries());
      obj.ong = ongId;

      try {
        const res = await fetch("/api/campanhas", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(obj)
        });

        if (res.ok) {
          form.reset();
          carregarCampanhas();
          alert("Campanha criada com sucesso!");
        } else {
          alert("Erro ao cadastrar a campanha.");
        }
      } catch (error) {
        console.error("Erro:", error);
        alert("Erro ao cadastrar a campanha.");
      }
    });

    // Mudar de tab
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => {
          b.style.color = "var(--text-secondary)";
          b.style.borderBottomColor = "transparent";
        });
        btn.style.color = "var(--accent)";
        btn.style.borderBottomColor = "var(--accent)";

        document.querySelectorAll(".tab-content").forEach(c => c.style.display = "none");
        document.getElementById(btn.dataset.tab).style.display = "block";
      });
    });

    carregarCampanhas();
  </script>

</body>
</html>


